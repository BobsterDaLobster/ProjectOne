<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>My Personal Profile</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: linear-gradient(to bottom right, babyblue, lightorange);
      margin: 0;
      padding: 0;
    }
    header {
      background: lightblue;
      padding: 10px;
      text-align: center;
    }
    #content {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
      padding: 20px;
    }
    section {
      background: white;
      border-radius: 10px;
      padding: 10px;
      box-shadow: 0 0 5px rgba(0,0,0,0.2);
      max-height: 600px;
      overflow: auto;
    }
    h2 {
      margin-top: 0;
    }
    #calendar {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 5px;
      text-align: center;
    }
    .day {
      padding: 5px;
      border-radius: 5px;
    }
    .today {
      background: lightcoral;
      color: white;
    }
    #gameContainer {
      position: relative;
      text-align: center;
    }
    #gameCanvas {
      border: 2px solid black;
      display: block;
      margin: 0 auto;
      background: #eee;
    }
    #keypad {
      position: absolute;
      bottom: 10px;
      right: 10px;
      display: grid;
      grid-template-columns: repeat(3, 50px);
      gap: 5px;
    }
    .key {
      background: lightblue;
      border: 1px solid #444;
      border-radius: 5px;
      padding: 10px;
      text-align: center;
      cursor: pointer;
      user-select: none;
    }
    .hidden-link {
      position: fixed;
      bottom: 5px;
      right: 5px;
      font-size: 8px;
      opacity: 0.2;
      cursor: pointer;
    }
    .news-article img {
      max-width: 100%;
    }
  </style>
</head>
<body>
  <header>
    <h1>My Personal Profile</h1>
  </header>

  <div id="content">
    <section>
      <h2>Calendar</h2>
      <div id="calendar-controls">
        <button onclick="prevMonth()">Previous</button>
        <span id="monthYear"></span>
        <button onclick="nextMonth()">Next</button>
      </div>
      <div id="calendar"></div>
      <div id="dayPreview">
        <h3>Events Today</h3>
        <ul id="eventsList"></ul>
        <input id="newEvent" placeholder="New Event">
        <button onclick="addEvent()">Add</button>
      </div>
    </section>

    <section>
      <h2>News</h2>
      <div id="news"></div>
    </section>

    <section id="gameContainer">
      <h2>Mini Game (Crossy Road)</h2>
      <canvas id="gameCanvas" width="400" height="560"></canvas>
      <div id="keypad">
        <div></div><div class="key" data-dir="up">↑</div><div></div>
        <div class="key" data-dir="left">←</div><div></div><div class="key" data-dir="right">→</div>
        <div></div><div class="key" data-dir="down">↓</div><div></div>
      </div>
    </section>
  </div>

  <div class="hidden-link" onclick="secretPrompt()">Secret</div>

  <script>
    // ===== Calendar =====
    let currentDate = new Date();
    let events = {};

    function renderCalendar() {
      const monthYear = document.getElementById('monthYear');
      const calendar = document.getElementById('calendar');
      calendar.innerHTML = '';
      const year = currentDate.getFullYear();
      const month = currentDate.getMonth();
      monthYear.textContent = currentDate.toLocaleString('default', { month: 'long', year: 'numeric' });

      const firstDay = new Date(year, month, 1).getDay();
      const daysInMonth = new Date(year, month + 1, 0).getDate();
      for (let i = 0; i < firstDay; i++) {
        const empty = document.createElement('div');
        calendar.appendChild(empty);
      }
      for (let day = 1; day <= daysInMonth; day++) {
        const div = document.createElement('div');
        div.className = 'day';
        if (day === (new Date()).getDate() && month === (new Date()).getMonth() && year === (new Date()).getFullYear()) {
          div.classList.add('today');
        }
        div.textContent = day;
        div.onclick = () => showEvents(year, month, day);
        calendar.appendChild(div);
      }
      showEvents(year, month, new Date().getDate());
    }

    function showEvents(year, month, day) {
      const key = `${year}-${month}-${day}`;
      const list = document.getElementById('eventsList');
      list.innerHTML = '';
      (events[key] || []).forEach((ev, idx) => {
        const li = document.createElement('li');
        li.textContent = ev;
        li.onclick = () => {
          events[key].splice(idx,1);
          showEvents(year, month, day);
        };
        list.appendChild(li);
      });
      list.setAttribute('data-key', key);
    }

    function addEvent() {
      const input = document.getElementById('newEvent');
      const key = document.getElementById('eventsList').getAttribute('data-key');
      if (!events[key]) events[key] = [];
      events[key].push(input.value);
      input.value = '';
      const [y,m,d] = key.split('-').map(Number);
      showEvents(y,m,d);
    }

    function prevMonth() {
      currentDate.setMonth(currentDate.getMonth()-1);
      renderCalendar();
    }
    function nextMonth() {
      currentDate.setMonth(currentDate.getMonth()+1);
      renderCalendar();
    }
    renderCalendar();

    // ===== News =====
    async function fetchNews() {
      try {
        const res = await fetch("https://api.rss2json.com/v1/api.json?rss_url=https://news.google.com/rss?hl=en-US&gl=US&ceid=US:en");
        const data = await res.json();
        const container = document.getElementById("news");
        container.innerHTML = "";
        data.items.slice(0,6).forEach(article => {
          const div = document.createElement("div");
          div.className = "news-article";
          div.innerHTML = `
            <h4><a href="${article.link}" target="_blank">${article.title}</a></h4>
            ${article.thumbnail ? `<img src="${article.thumbnail}">` : ""}
            <p>${article.description || ""}</p>
          `;
          container.appendChild(div);
        });
      } catch (e) {
        console.error("News fetch error", e);
      }
    }
    fetchNews();
    setInterval(fetchNews, 1800000); // refresh every 30 minutes

    // ===== Secret Redirect =====
    function secretPrompt() {
      const code = prompt("Enter the code:");
      if (code === "494849") {
        window.location.href = "https://poki.com";
      } else {
        alert("Wrong code!");
      }
    }

    // ===== Game Logic =====
    const canvasEl = document.getElementById('gameCanvas');
    const ctx = canvasEl.getContext('2d');
    const TILE = 20;
    const PLAYER_SIZE = 20;
    let player, lanes, offsetY, score;

    function resetGame() {
      player = { x: 10 * TILE, y: 26 * TILE, size: PLAYER_SIZE, onLog: false };
      lanes = [];
      offsetY = 0;
      score = 0;
      generateInitialLanes();
      requestAnimationFrame(gameLoop);
    }

    function generateInitialLanes() {
      for (let i = 0; i < 30; i++) {
        generateLane(i);
      }
    }

    function generateLane(i) {
      if (i % 10 === 0) {
        lanes.push({ type: "safe", entities: [] });
        return;
      }
      const r = Math.random();
      if (r < 0.4) {
        lanes.push({
          type: "road",
          entities: [{ x: Math.random() * canvasEl.width, y: i * TILE, speed: (Math.random() < 0.5 ? 1 : -1) * 1.5 }]
        });
      } else if (r < 0.6) {
        let logs = [];
        for (let j = 0; j < 3; j++) {
          logs.push({ x: Math.random() * canvasEl.width, y: i * TILE, speed: (Math.random() < 0.5 ? 1 : -1) * 1.2 });
        }
        lanes.push({ type: "river", entities: logs });
      } else {
        lanes.push({ type: "grass", entities: [] });
      }
    }

    function move(dir) {
      if (dir === 'up') player.y -= TILE;
      if (dir === 'down') player.y += TILE;
      if (dir === 'left') player.x -= TILE;
      if (dir === 'right') player.x += TILE;
      player.x = Math.floor(player.x / TILE) * TILE;
      player.y = Math.floor(player.y / TILE) * TILE;
      if (player.y < 10 * TILE) {
        offsetY += TILE;
        player.y += TILE;
        score++;
        if (lanes.length < score / TILE + 40) generateLane(lanes.length);
      }
    }

    function gameLoop() {
      ctx.clearRect(0, 0, canvasEl.width, canvasEl.height);
      for (let i = 0; i < lanes.length; i++) {
        let lane = lanes[i];
        let y = canvasEl.height - (i * TILE - offsetY);
        if (lane.type === "road") {
          ctx.fillStyle = "gray";
          ctx.fillRect(0, y, canvasEl.width, TILE);
          lane.entities.forEach(car => {
            car.x += car.speed;
            if (car.x > canvasEl.width) car.x = -TILE * 2;
            if (car.x < -TILE * 2) car.x = canvasEl.width;
            ctx.fillStyle = "red";
            ctx.fillRect(car.x, y, TILE, TILE);
            if (player.y === y && player.x < car.x + TILE && player.x + TILE > car.x) {
              resetGame();
            }
          });
        } else if (lane.type === "river") {
          ctx.fillStyle = "blue";
          ctx.fillRect(0, y, canvasEl.width, TILE);
          player.onLog = false;
          lane.entities.forEach(log => {
            log.x += log.speed;
            if (log.x > canvasEl.width) log.x = -TILE * 3;
            if (log.x < -TILE * 3) log.x = canvasEl.width;
            ctx.fillStyle = "brown";
            ctx.fillRect(log.x, y, TILE * 3, TILE);
            if (player.y === y && player.x + TILE > log.x && player.x < log.x + TILE * 3) {
              player.onLog = true;
              player.x += log.speed;
            }
          });
          if (player.y === y && !player.onLog) {
            resetGame();
          }
        } else {
          ctx.fillStyle = "green";
          ctx.fillRect(0, y, canvasEl.width, TILE);
        }
      }
      ctx.fillStyle = "yellow";
      ctx.fillRect(player.x, player.y, player.size, player.size);
      requestAnimationFrame(gameLoop);
    }

    document.querySelectorAll(".key").forEach(btn => {
      btn.addEventListener("click", () => {
        move(btn.dataset.dir);
      });
    });

    resetGame();
  </script>
</body>
</html>
