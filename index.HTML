<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Personal Profile — News, Calendar, Crossy</title>
<style>
  :root{
    --baby-blue:#BFEFFF;
    --baby-blue-2:#EAF7FF;
    --light-orange:#FFD9A6;
    --accent:#FFBD70;
    --muted:#6b7280;
    --radius:12px;
  }
  html,body{height:100%; margin:0; font-family:Inter,system-ui,Segoe UI,Roboto,Arial; background:linear-gradient(180deg,var(--baby-blue),var(--baby-blue-2)); color:#072034}
  header{background:var(--light-orange); padding:12px 16px; display:flex;align-items:center;justify-content:space-between}
  header h1{margin:0;font-size:18px}
  .container{max-width:1100px;margin:18px auto;padding:16px;background:#ffffffcc;border-radius:var(--radius);box-shadow:0 10px 30px rgba(2,6,23,.06);border:3px solid var(--light-orange)}
  .row{display:flex;gap:14px;flex-wrap:wrap}
  .col{flex:1;min-width:280px}
  section{background:#fff;border-radius:10px;padding:12px;box-shadow:0 6px 18px rgba(2,6,23,.04)}
  textarea,input{width:100%;padding:8px;border-radius:8px;border:1px solid #eee}
  button{background:var(--light-orange);border:none;padding:7px 10px;border-radius:8px;cursor:pointer}
  .muted{color:var(--muted);font-size:13px}
  /* Calendar */
  .cal-controls{display:flex;gap:8px;align-items:center;justify-content:space-between}
  .cal-grid{display:grid;grid-template-columns:repeat(7,1fr);gap:6px;margin-top:8px}
  .cal-cell{min-height:86px;background:#f8fafc;padding:8px;border-radius:8px;position:relative;cursor:pointer}
  .cal-cell.today{box-shadow:inset 0 0 0 2px var(--accent)}
  .cal-cell .small{font-size:12px;color:var(--muted)}
  .event-panel{background:#fff;padding:10px;border-radius:10px;box-shadow:0 6px 18px rgba(2,6,23,.03)}
  /* News */
  .news-list{display:flex;flex-direction:column;gap:8px}
  .news-item{display:flex;gap:10px;padding:8px;border-radius:8px;align-items:flex-start;background:#fbfdff}
  .news-item img{width:110px;height:66px;object-fit:cover;border-radius:6px}
  .news-item a{font-weight:600;color:#062033;text-decoration:none}
  .news-item p{margin:4px 0;color:var(--muted);font-size:13px}
  /* Game */
  .game-wrap{position:relative}
  canvas{display:block;border-radius:10px;border:3px solid var(--light-orange);background:linear-gradient(#e6f7ff,#dff6ff);width:100%;height:auto;max-width:720px}
  /* tiny secret dot */
  #secretDot{position:fixed;right:10px;bottom:10px;width:10px;height:10px;border-radius:50%;background:rgba(20,20,20,0.06);cursor:pointer;z-index:50}
  /* modal */
  .modal{position:fixed;inset:0;background:rgba(0,0,0,0.45);display:flex;align-items:center;justify-content:center;z-index:60}
  .modal-card{background:white;padding:16px;border-radius:10px;max-width:420px;width:92%}
  .kbd{user-select:none}
  @media (max-width:860px){ .row{flex-direction:column} .news-item img{display:none} }
</style>
</head>
<body>
<header>
  <div>
    <h1 contenteditable id="profileName">Your Name</h1>
    <div contenteditable id="profileTitle" class="muted">Your Title</div>
  </div>
  <nav class="muted"><a href="https://apple.news" target="_blank">Apple News</a> • <a href="https://espn.com" target="_blank">ESPN</a> • <a href="https://youtube.com" target="_blank">YouTube</a></nav>
</header>

<main class="container">
  <div class="row" style="margin-bottom:12px">
    <div class="col">
      <section>
        <h2>About</h2>
        <p id="aboutMe" contenteditable class="muted">Edit your bio here.</p>
      </section>
    </div>
    <div class="col">
      <section>
        <h2>Resume</h2>
        <textarea id="resume" rows="6" placeholder="Paste your resume..."></textarea>
      </section>
    </div>
  </div>

  <div class="row">
    <div class="col" style="flex:0 1 660px">
      <section>
        <div class="cal-controls">
          <div>
            <button id="prevMonth">Prev</button>
            <button id="nextMonth">Next</button>
          </div>
          <div><strong id="calTitle">Month Year</strong></div>
        </div>

        <div style="display:flex;gap:12px;margin-top:10px">
          <div style="flex:1">
            <div class="cal-grid" id="calendarGrid"></div>
          </div>
          <div style="width:260px">
            <div class="event-panel">
              <h3 id="panelDate">Select a date</h3>
              <ul id="panelEvents" style="padding-left:12px"></ul>
              <input id="panelNew" placeholder="New event" />
              <div style="margin-top:8px"><button id="panelAdd">Add event</button></div>
            </div>
          </div>
        </div>
      </section>

      <section style="margin-top:12px">
        <h3>Mini-Game — Crossy Road (Endless)</h3>
        <div class="game-wrap">
          <canvas id="gameCanvas" width="700" height="420"></canvas>
        </div>
        <div class="muted" style="margin-top:8px">Use arrow keys / WASD or tap the on-screen keys (bottom-right of game). Score = lanes crossed.</div>
      </section>
    </div>

    <div class="col">
      <section>
        <h3>Sports (ESPN)</h3>
        <div id="sportsFeed" class="news-list"></div>
      </section>

      <section style="margin-top:12px">
        <h3>Notre Dame Fighting Irish</h3>
        <div id="ndFeed" class="news-list"></div>
      </section>

      <section style="margin-top:12px">
        <h3>World News</h3>
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px">
          <div>
            <h4>Science</h4>
            <div id="scienceFeed" class="news-list"></div>
          </div>
          <div>
            <h4>National Politics</h4>
            <div id="nationalFeed" class="news-list"></div>
          </div>
          <div>
            <h4>International Politics</h4>
            <div id="internationalFeed" class="news-list"></div>
          </div>
          <div>
            <h4>Sports News</h4>
            <div id="sportsNewsFeed" class="news-list"></div>
          </div>
        </div>
        <div class="muted" style="margin-top:8px">Feeds powered by RSS &amp; rss2json; auto-refresh every 30 minutes.</div>
      </section>
    </div>
  </div>
</main>

<div id="secretDot" title="secret"></div>

<!-- modal for secret -->
<div id="secretModal" class="modal" style="display:none">
  <div class="modal-card">
    <div style="display:flex;justify-content:space-between;align-items:center"><strong>Enter secret code</strong><button onclick="closeSecret()">Close</button></div>
    <div style="margin-top:10px"><input id="secretInput" placeholder="code" /></div>
    <div style="margin-top:10px;display:flex;justify-content:flex-end"><button onclick="trySecret()">Go</button></div>
  </div>
</div>

<script>
/* ---------------------------
   Local persistence for profile/resume/about
   --------------------------- */
const aboutEl = document.getElementById('aboutMe');
aboutEl.innerText = localStorage.getItem('aboutMe') || aboutEl.innerText;
aboutEl.addEventListener('input', ()=> localStorage.setItem('aboutMe', aboutEl.innerText));

const nameEl = document.getElementById('profileName');
nameEl.innerText = localStorage.getItem('profileName') || nameEl.innerText;
nameEl.addEventListener('input', ()=> localStorage.setItem('profileName', nameEl.innerText));

const titleEl = document.getElementById('profileTitle');
titleEl.innerText = localStorage.getItem('profileTitle') || titleEl.innerText;
titleEl.addEventListener('input', ()=> localStorage.setItem('profileTitle', titleEl.innerText));

const resumeEl = document.getElementById('resume');
resumeEl.value = localStorage.getItem('resume') || '';
resumeEl.addEventListener('input', ()=> localStorage.setItem('resume', resumeEl.value));

/* ---------------------------
   Calendar with side event panel
   --------------------------- */
const calendarGrid = document.getElementById('calendarGrid');
const calTitle = document.getElementById('calTitle');
const panelDate = document.getElementById('panelDate');
const panelEvents = document.getElementById('panelEvents');
const panelNew = document.getElementById('panelNew');
const panelAdd = document.getElementById('panelAdd');

const today = new Date();
let calBase = new Date(today.getFullYear(), today.getMonth(), 1);
const EVENTS_KEY = 'pp_events_v1';
let events = JSON.parse(localStorage.getItem(EVENTS_KEY) || '{}');

function dateKey(d){ return d.toDateString(); }

function renderMonth(base){
  calendarGrid.innerHTML = '';
  calTitle.innerText = base.toLocaleString(undefined,{month:'long', year:'numeric'});
  const year = base.getFullYear(), month = base.getMonth();
  const firstDow = new Date(year, month, 1).getDay();
  const daysInMonth = new Date(year, month+1, 0).getDate();
  // weekday headers
  const wk = ['Sun','Mon','Tue','Wed','Thu','Fri','Sat'];
  wk.forEach(h=>{
    const el = document.createElement('div'); el.style.fontWeight='700'; el.style.textAlign='center'; el.textContent = h;
    calendarGrid.appendChild(el);
  });
  // calendar cells (6 rows x 7 cols)
  for(let i=0;i<42;i++){
    const cell = document.createElement('div');
    cell.className = 'cal-cell';
    // compute day number
    const dayIndex = i - firstDow + 1;
    if(dayIndex>0 && dayIndex<=daysInMonth){
      const d = new Date(year, month, dayIndex);
      cell.innerHTML = `<div style="text-align:left;font-weight:600">${dayIndex}</div><div class="small">${(events[dateKey(d)]||[]).slice(0,2).map(s=>escapeHTML(s)).join('<br>')}</div>`;
      if(d.toDateString() === today.toDateString()) cell.classList.add('today');
      cell.addEventListener('click', ()=> selectDate(d));
    } else {
      cell.style.background='transparent'; cell.style.cursor='default';
    }
    calendarGrid.appendChild(cell);
  }
}
function selectDate(d){
  const k = dateKey(d);
  panelDate.innerText = k;
  panelEvents.innerHTML = '';
  (events[k]||[]).forEach((ev,i)=>{
    const li = document.createElement('li');
    li.innerHTML = `${escapeHTML(ev)} <button onclick="deleteEvent('${k}',${i})">Delete</button>`;
    panelEvents.appendChild(li);
  });
  panelDate.dataset.key = k;
}
function addEvent(){ const k = panelDate.dataset.key; if(!k) return; const txt = panelNew.value.trim(); if(!txt) return; if(!events[k]) events[k]=[]; events[k].push(txt); panelNew.value=''; localStorage.setItem(EVENTS_KEY, JSON.stringify(events)); selectDate(new Date(k)); renderMonth(calBase); }
function deleteEvent(k,i){ if(!events[k]) return; events[k].splice(i,1); if(events[k].length===0) delete events[k]; localStorage.setItem(EVENTS_KEY, JSON.stringify(events)); selectDate(new Date(k)); renderMonth(calBase); }
panelAdd.addEventListener('click', addEvent);

document.getElementById('prevMonth').addEventListener('click', ()=>{ calBase.setMonth(calBase.getMonth()-1); renderMonth(calBase); });
document.getElementById('nextMonth').addEventListener('click', ()=>{ calBase.setMonth(calBase.getMonth()+1); renderMonth(calBase); });

// initialize
renderMonth(calBase); selectDate(today);

/* ---------------------------
   News via RSS (rss2json proxy)
   auto-refresh every 30 minutes
   --------------------------- */
const FEED = {
  sports: 'https://www.espn.com/espn/rss/news',
  nd: 'https://news.google.com/rss/search?q=Notre+Dame+Fighting+Irish+football&hl=en-US&gl=US&ceid=US:en',
  science: 'https://news.google.com/rss/search?q=science&hl=en-US&gl=US&ceid=US:en',
  national: 'https://news.google.com/rss/search?q=US+politics&hl=en-US&gl=US&ceid=US:en',
  international: 'https://news.google.com/rss/search?q=international+politics&hl=en-US&gl=US&ceid=US:en',
  sportsNews: 'https://news.google.com/rss/search?q=sports&hl=en-US&gl=US&ceid=US:en'
};

function renderNewsItem(it){
  const title = escapeHTML(it.title||'');
  const link = it.link || '#';
  let img = it.thumbnail || '';
  if(!img && it.description){
    const m = it.description.match(/<img[^>]+src=\"([^\">]+)\"/i);
    if(m) img = m[1];
  }
  const summary = escapeHTML((it.description||'').replace(/(<([^>]+)>)/gi, '').trim().slice(0,220));
  return `<div class="news-item"><a href="${link}" target="_blank">${img?`<img src="${img}" alt="">`:'<div style="width:110px;height:66px;border-radius:6px;background:#f0f6fb"></div>'}</a><div style="flex:1"><a href="${link}" target="_blank">${title}</a><p>${summary}</p></div></div>`;
}

async function fetchFeed(url, containerId, limit=5){
  const container = document.getElementById(containerId);
  container.innerHTML = '<div class="muted">Loading…</div>';
  try{
    const api = 'https://api.rss2json.com/v1/api.json?rss_url=' + encodeURIComponent(url);
    const res = await fetch(api);
    if(!res.ok) throw new Error('fetch failed');
    const data = await res.json();
    const items = (data.items||[]).slice(0, limit);
    container.innerHTML = items.map(renderNewsItem).join('');
  }catch(e){
    container.innerHTML = `<div class="muted">Unable to load feed. <a href="${url}" target="_blank">Open source</a></div>`;
    console.warn('rss err', e);
  }
}

function refreshAllFeeds(){
  fetchFeed(FEED.sports, 'sportsFeed', 6);
  fetchFeed(FEED.nd, 'ndFeed', 6);
  fetchFeed(FEED.science, 'scienceFeed', 4);
  fetchFeed(FEED.national, 'nationalFeed', 4);
  fetchFeed(FEED.international, 'internationalFeed', 4);
  fetchFeed(FEED.sportsNews, 'sportsNewsFeed', 4);
}
// initial load
refreshAllFeeds();
// background refresh every 30 minutes (1800000 ms)
setInterval(refreshAllFeeds, 1800000);

/* ---------------------------
   Secret dot & modal
   --------------------------- */
const secretDot = document.getElementById('secretDot');
const secretModal = document.getElementById('secretModal');
secretDot.addEventListener('click', ()=> secretModal.style.display='flex');
function closeSecret(){ secretModal.style.display='none'; }
function trySecret(){
  const code = document.getElementById('secretInput').value.trim();
  if(code === '494849') window.open('https://poki.com','_blank');
  else alert('Wrong code');
}

/* ---------------------------
   Crossy Road Game (slower speeds)
   - camera follows player (world scroll)
   - rivers with logs (plentiful)
   - initial 5-lane safe zone
   - cars spawn less often, logs plentiful but slower
   --------------------------- */
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
const W = canvas.width, H = canvas.height;

let lanes = [];    // each: {y,type, cars[], logs[], pattern...}
let cars = [];     // active cars
let logs = [];     // active logs
let player = { x: W/2 - 12, y: H - 36, w: 24, h: 24 };
let camY = 0;      // camera offset
let lanesCrossed = 0;
let lastTime = performance.now();
let accumSpawn = 0;

// spawn tuning (slower speeds: half previous)
const CAR_SPAWN_BASE = 0.010;    // per lane per frame-ish probability base (keeps spawn low)
const LOG_SPAWN_BASE = 0.04;     // per river lane per frame-ish (plentiful)
const CAR_SPEED_MULT = 0.6;      // base speed multiplier (reduced)
const LOG_SPEED_MULT = 0.5;      // base log speed (reduced)

function resetWorld(){
  lanes = [];
  cars = [];
  logs = [];
  player.x = W/2 - 12; player.y = H - 36; camY = 0; lanesCrossed = 0;
  // initial 5 grass lanes
  for(let i=0;i<5;i++) lanes.push({ idx:i, y:i*48, type:'grass', cars:[], logs:[] });
  // pre-generate more lanes ahead
  for(let i=5;i<70;i++) generateLane(i);
}

// generate lane type ensuring rivers spacing and safe zones every 10 lanes (starting after initial 5)
function generateLane(index){
  // if index is multiple of 10 -> safe grass zone
  if(index>0 && (index % 10) === 0){
    lanes.push({ idx:index, y:index*48, type:'grass', cars:[], logs:[] });
    return;
  }
  // don't place river if near a safe zone (skip if next to multiple of 10)
  const nearSafe = ((index+1) % 10 === 0) || ((index-1) % 10 === 0);
  if(!nearSafe){
    // random 10-20 lane spacing approximate: we'll use a modest probability
    if(Math.random() < 0.12){
      lanes.push({ idx:index, y:index*48, type:'river', cars:[], logs:[] });
      return;
    }
  }
  // otherwise mostly road with some grass
  const r = Math.random();
  if(r < 0.7) lanes.push({ idx:index, y:index*48, type:'road', cars:[], logs:[] });
  else lanes.push({ idx:index, y:index*48, type:'grass', cars:[], logs:[] });
}

// helper to spawn a car on a specific road lane
function spawnCarOn(lane){
  // spawn fewer cars: sample chance small; we'll spawn here when called
  const dir = Math.random() < 0.5 ? 1 : -1;
  const base = 1.0 + Math.random()*1.4; // base magnitude
  const speed = base * CAR_SPEED_MULT * (dir === 1 ? 1 : -1);
  const x = dir === 1 ? -80 : W + 80;
  cars.push({ x, y: lane.y + 12, w: 44 + Math.random()*20, h: 24, speed });
}

// helper to spawn log on a river lane (plentiful)
function spawnLogOn(lane){
  const dir = Math.random() < 0.5 ? 1 : -1;
  const speed = (0.6 + Math.random()*1.0) * LOG_SPEED_MULT * (dir===1?1:-1);
  const width = 70 + Math.random()*60; // varied sizes
  const x = dir === 1 ? -width - Math.random()*80 : W + Math.random()*80;
  logs.push({ x, y: lane.y + 12, w: width, h: 24, speed });
}

// main loop
function gameTick(now){
  const dt = Math.min(40, now - lastTime); // clamp
  lastTime = now;
  accumSpawn += dt;

  // spawn logic: iterate lanes visible near camera and occasionally spawn
  for(let i=0;i<lanes.length;i++){
    const lane = lanes[i];
    if(lane.type === 'road'){
      // spawn probability tuned down (less cars); use time-based spawn:
      if(Math.random() < CAR_SPAWN_BASE){ // reduced spawn
        spawnCarOn(lane);
      }
    } else if(lane.type === 'river'){
      // plentiful logs but spawn rate slightly reduced (we keep them plentiful)
      if(Math.random() < LOG_SPAWN_BASE){ spawnLogOn(lane); }
    }
  }

  // update cars
  for(let i=cars.length-1;i>=0;i--){
    const c = cars[i];
    c.x += c.speed * (dt/16);
    if(c.x < -200 || c.x > W + 200) cars.splice(i,1);
  }
  // update logs
  for(let i=logs.length-1;i>=0;i--){
    const l = logs[i];
    l.x += l.speed * (dt/16);
    if(l.x < -400 || l.x > W + 400) logs.splice(i,1);
  }

  // movement from keyboard (keydown sets keys)
  if(keys.ArrowUp || keys.w) player.y -= 36 * (dt/16);
  if(keys.ArrowDown || keys.s) player.y += 36 * (dt/16);
  if(keys.ArrowLeft || keys.a) player.x -= 36 * (dt/16);
  if(keys.ArrowRight || keys.d) player.x += 36 * (dt/16);

  // clamp player horizontally
  player.x = Math.max(6, Math.min(W - player.w - 6, player.x));

  // camera: keep player vertically around middle y ~ H*0.6
  const targetCam = player.y - H*0.6;
  camY += (targetCam - camY) * 0.2;

  // ensure enough lanes ahead
  const maxIdx = lanes.length ? lanes[lanes.length-1].idx : 0;
  while(lanes.length < 120 && maxIdx + lanes.length < 10000 && lanes.length < 200){
    const nextIdx = lanes.length ? lanes[lanes.length-1].idx + 1 : 0;
    generateLane(nextIdx);
  }

  // collisions & river logic
  // determine which lane the player is on
  const playerWorldY = player.y;
  const nearestLaneIdx = Math.floor(playerWorldY / 48);
  const lane = lanes.find(l => l.idx === nearestLaneIdx);

  let onLog = false;
  if(lane){
    if(lane.type === 'road'){
      // check car collisions
      for(const c of cars){
        if(Math.abs((c.y) - (lane.y + 12)) < 20){
          if(player.x < c.x + c.w && player.x + player.w > c.x && player.y < c.y + c.h && player.y + player.h > c.y){
            // hit car -> reset
            resetGame();
            return;
          }
        }
      }
    } else if(lane.type === 'river'){
      // check logs: if standing on log, move with it; else drown
      for(const l of logs){
        if(Math.abs(l.y - (lane.y + 12)) < 18){
          if(player.x < l.x + l.w && player.x + player.w > l.x && player.y < l.y + l.h && player.y + player.h > l.y){
            onLog = true;
            // move with log
            player.x += l.speed * (dt/16);
          }
        }
      }
      if(!onLog){
        // drown -> game over
        resetGame();
        return;
      }
    }
  }

  // scoring: count how many lanes player has passed (floor of idx)
  const crossed = Math.max(0, Math.floor(player.y / 48) - 4); // subtract initial safe zone
  if(crossed > lanesCrossed){
    lanesCrossed = crossed;
  }

  render();
  requestAnimationFrame(gameTick);
}

function resetGame(){
  // reinitialize player to start position and clear dynamic objects
  player.x = W/2 - 12;
  player.y = 48*2; // keep inside initial safe region
  camY = 0;
  lanes = [];
  cars.length = 0;
  logs.length = 0;
  lanesCrossed = 0;
  // initial 5 grass lanes
  for(let i=0;i<5;i++) lanes.push({ idx:i, y:i*48, type:'grass', cars:[], logs:[] });
  // prebuild
  for(let i=5;i<120;i++) generateLane(i);
}

// draw world
function render(){
  ctx.clearRect(0,0,W,H);
  ctx.save();
  ctx.translate(0, -camY);

  // draw lanes in view
  const firstIdx = Math.floor(camY / 48) - 2;
  const lastIdx = Math.floor((camY + H) / 48) + 2;
  for(let i=Math.max(0,firstIdx); i<=lastIdx; i++){
    const lane = lanes[i];
    if(!lane) continue;
    const y = lane.y;
    // lane style
    if(lane.type === 'grass'){
      ctx.fillStyle = '#98fb98';
    } else if(lane.type === 'road'){
      ctx.fillStyle = '#777';
    } else { // river
      ctx.fillStyle = '#57a8ff';
    }
    ctx.fillRect(0, y, W, 48);

    // optionally draw separators
    ctx.strokeStyle = 'rgba(255,255,255,0.06)';
    ctx.strokeRect(0, y, W, 48);
  }

  // draw cars
  for(const c of cars){
    ctx.fillStyle = '#ff6b6b';
    ctx.fillRect(c.x, c.y, c.w, c.h);
  }
  // draw logs
  for(const l of logs){
    ctx.fillStyle = '#8b5a2b';
    ctx.fillRect(l.x, l.y, l.w, l.h);
  }

  // draw player
  ctx.fillStyle = '#ffde59';
  ctx.fillRect(player.x, player.y, player.w, player.h);

  ctx.restore();

  // HUD
  ctx.fillStyle = '#072034';
  ctx.font = '16px sans-serif';
  ctx.fillText('Lanes: ' + lanesCrossed, 12, 20);

  // Draw fixed keypad inside canvas bottom-right (fixed size)
  const kbW = 140, kbH = 120;
  const bx = W - kbW - 12;
  const by = H - kbH - 12;
  ctx.fillStyle = 'rgba(255,217,166,0.95)';
  ctx.fillRect(bx, by, kbW, kbH);
  ctx.fillStyle = '#072034';
  ctx.strokeStyle = 'rgba(0,0,0,0.08)';
  ctx.strokeRect(bx, by, kbW, kbH);

  // draw keys (positions relative)
  ctx.font = '18px sans-serif';
  const keySize = 36;
  const kx = bx + 18, ky = by + 12;
  // up
  drawKey(kx + keySize + 4, ky, '⬆️');
  // left
  drawKey(kx, ky + keySize + 6, '⬅️');
  // down
  drawKey(kx + keySize + 4, ky + keySize + 6, '⬇️');
  // right
  drawKey(kx + (keySize+4)*2, ky + keySize + 6, '➡️');
  // restart
  drawKey(kx + keySize + 4, ky + (keySize+6)*2, '🔁');
}

// helper draw key
function drawKey(x,y,label){
  ctx.fillStyle = '#ffffff';
  ctx.fillRect(x,y,36,36);
  ctx.strokeStyle = '#e6c9a1';
  ctx.strokeRect(x,y,36,36);
  ctx.fillStyle = '#333';
  ctx.fillText(label, x+8, y+24);
}

// input handling (keyboard & canvas click for keypad)
const keys = {};
window.addEventListener('keydown', (e)=>{ keys[e.key] = true; if(e.key==='r') resetGame(); });
window.addEventListener('keyup', (e)=> keys[e.key] = false);

// canvas click for keypad
canvas.addEventListener('click', function(evt){
  const rect = canvas.getBoundingClientRect();
  const x = evt.clientX - rect.left;
  const y = evt.clientY - rect.top;
  const kbW = 140, kbH = 120;
  const bx = W - kbW - 12;
  const by = H - kbH - 12;
  if(x >= bx && x <= bx + kbW && y >= by && y <= by + kbH){
    // determine which key region
    const rx = x - bx, ry = y - by;
    // positions as drawn above
    // up: around (18+keySize+4,12) => centered at (18+20,12+18) => rx in [18+18-18, ...]
    const keySize = 36;
    // compute grid centres
    const centers = {
      up: {cx: 18 + keySize + 4 + keySize/2, cy: 12 + keySize/2},
      left: {cx: 18 + keySize/2, cy: 12 + keySize + 6 + keySize/2},
      down: {cx: 18 + keySize + 4 + keySize/2, cy: 12 + keySize + 6 + keySize/2},
      right: {cx: 18 + (keySize+4)*2 + keySize/2, cy: 12 + keySize + 6 + keySize/2},
      restart: {cx: 18 + keySize + 4 + keySize/2, cy: 12 + (keySize+6)*2 + keySize/2}
    };
    for(const k in centers){
      const c = centers[k];
      const dx = rx - c.cx, dy = ry - c.cy;
      if(Math.sqrt(dx*dx + dy*dy) < 28){
        // trigger
        if(k==='up') { keys['ArrowUp']=true; setTimeout(()=>keys['ArrowUp']=false,150); }
        if(k==='left') { keys['ArrowLeft']=true; setTimeout(()=>keys['ArrowLeft']=false,150); }
        if(k==='down') { keys['ArrowDown']=true; setTimeout(()=>keys['ArrowDown']=false,150); }
        if(k==='right') { keys['ArrowRight']=true; setTimeout(()=>keys['ArrowRight']=false,150); }
        if(k==='restart') resetGame();
      }
    }
  }
});

// start/reset world
resetGame();
requestAnimationFrame(gameTick);

/* small util */
function escapeHTML(s){ return String(s||'').replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;'); }
</script>
</body>
</html>
