<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Personal Profile — Infinite Crossy Road</title>
<style>
  :root{--baby:#add8e6;--peach:#ffd580;--accent:#87cefa;--dark:#333}
  html,body{height:100%;margin:0;font-family:Arial,Helvetica,sans-serif;background:linear-gradient(90deg,var(--baby),var(--peach))}
  header{background:var(--accent);color:#fff;padding:14px;text-align:center}
  main{max-width:1100px;margin:14px auto;padding:0 12px}
  section{background:#fff;border-radius:10px;padding:12px;margin-bottom:12px;box-shadow:0 2px 6px rgba(0,0,0,.08)}
  h1,h2{margin:6px 0}
  /* calendar */
  .calendar-wrap{display:flex;gap:14px;flex-wrap:wrap}
  .calendar{min-width:320px}
  .calendar-grid{display:grid;grid-template-columns:repeat(7,1fr);gap:6px}
  .day{padding:8px;border-radius:6px;text-align:center;cursor:pointer;border:1px solid rgba(0,0,0,.06)}
  .today{background:var(--peach);font-weight:700}
  .events-panel{min-width:260px}
  /* game */
  #gameWrap{position:relative;max-width:760px;margin:0 auto}
  canvas{display:block;width:100%;height:auto;border-radius:6px;background:#eaf8ff;border:3px solid var(--dark)}
  #keypad{position:absolute;right:12px;bottom:12px;display:grid;grid-template-columns:repeat(3,46px);gap:6px;pointer-events:none}
  .kbtn{width:46px;height:42px;border-radius:8px;background:var(--accent);color:#fff;border:none;font-weight:700;cursor:pointer;pointer-events:auto;box-shadow:0 2px 4px rgba(0,0,0,.12)}
  #scoreboard{position:absolute;left:12px;top:12px;background:rgba(255,255,255,0.9);padding:8px;border-radius:6px;font-weight:700}
  /* news */
  .news-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));gap:10px}
  .article{background:#fff;padding:8px;border-radius:8px;box-shadow:0 1px 4px rgba(0,0,0,.06)}
  .secret{position:fixed;bottom:6px;right:6px;width:14px;height:14px;opacity:.2;cursor:pointer}
  @media (max-width:820px){ .calendar{width:100%} #gameWrap{max-width:100%} }
</style>
</head>
<body>
<header><h1>My Personal Profile</h1></header>
<main>

  <section>
    <h2>My Resume</h2>
    <p>Paste your resume here (editable later).</p>
  </section>

  <section>
    <h2>Calendar</h2>
    <div style="display:flex;align-items:center;gap:12px;margin-bottom:8px">
      <button onclick="prevMonth()">Previous</button>
      <div id="monthYear"></div>
      <button onclick="nextMonth()">Next</button>
    </div>
    <div class="calendar-wrap">
      <div class="calendar">
        <div class="calendar-grid" id="calendarGrid"></div>
      </div>
      <div class="events-panel">
        <h3 id="selectedDate">Select a day</h3>
        <ul id="eventList"></ul>
        <input id="newEventInput" placeholder="New event" style="width:100%;padding:8px;margin-top:8px"/>
        <button style="margin-top:8px" onclick="addEvent()">Add</button>
      </div>
    </div>
  </section>

  <section>
    <h2>Mini-Game: Crossy Road (infinite)</h2>
    <div id="gameWrap">
      <canvas id="gameCanvas" width="760" height="520"></canvas>
      <div id="scoreboard">Score: 0<br>High: 0</div>
      <div id="keypad">
        <button class="kbtn" data-dir="up">⬆</button>
        <button class="kbtn" data-dir="left">⬅</button>
        <button class="kbtn" data-dir="down">⬇</button>
        <button class="kbtn" data-dir="right">➡</button>
        <button class="kbtn" data-dir="reset">⟲</button>
      </div>
    </div>
    <p style="text-align:center;font-size:.95rem;margin-top:8px">Use arrow keys or on-screen keys. Press R to reset.</p>
  </section>

  <section>
    <h2>Sports (ESPN)</h2>
    <p><a href="https://www.espn.com" target="_blank" rel="noopener">Open ESPN for highlights</a></p>
  </section>

  <section>
    <h2>Notre Dame Fighting Irish</h2>
    <p><a href="https://www.espn.com/college-football/team/_/id/87/notre-dame-fighting-irish" target="_blank" rel="noopener">Notre Dame on ESPN</a></p>
  </section>

  <section>
    <h2>World News</h2>
    <div style="margin-bottom:8px"><strong>Sections:</strong> Science • National Politics • International Politics • Sports</div>
    <div>
      <h4>Top headlines</h4>
      <div id="newsGrid" class="news-grid"></div>
    </div>
  </section>

</main>

<div class="secret" id="secretArea" title="Secret"></div>

<script>
/* ---------------- Calendar ---------------- */
const calendarGrid = document.getElementById('calendarGrid');
const monthYearEl = document.getElementById('monthYear');
const selectedDateTitle = document.getElementById('selectedDate');
const eventListEl = document.getElementById('eventList');
const newEventInput = document.getElementById('newEventInput');

let calDate = new Date();
let storedEvents = JSON.parse(localStorage.getItem('profile_events') || '{}');

function renderCalendar(){
  calendarGrid.innerHTML = '';
  const year = calDate.getFullYear(), month = calDate.getMonth();
  monthYearEl.textContent = calDate.toLocaleString('default',{month:'long', year:'numeric'});
  ['Sun','Mon','Tue','Wed','Thu','Fri','Sat'].forEach(d=>{
    const el = document.createElement('div'); el.textContent = d; el.style.fontWeight='700'; calendarGrid.appendChild(el);
  });
  const firstDay = new Date(year,month,1).getDay();
  for(let i=0;i<firstDay;i++) calendarGrid.appendChild(document.createElement('div'));
  const daysInMonth = new Date(year,month+1,0).getDate();
  for(let d=1; d<=daysInMonth; d++){
    const cell = document.createElement('div'); cell.className='day'; cell.textContent=d;
    const today = new Date();
    if(d===today.getDate() && month===today.getMonth() && year===today.getFullYear()){
      cell.classList.add('today'); selectDay(year,month,d);
    }
    cell.onclick = ()=> selectDay(year,month,d);
    calendarGrid.appendChild(cell);
  }
}
function dayKey(y,m,d){ return `${y}-${m}-${d}`; }
function selectDay(y,m,d){
  const k = dayKey(y,m,d);
  selectedDateTitle.textContent = new Date(y,m,d).toDateString();
  eventListEl.innerHTML = '';
  (storedEvents[k]||[]).forEach((ev, idx)=>{
    const li = document.createElement('li'); li.textContent = ev;
    const del = document.createElement('button'); del.textContent = 'X'; del.style.marginLeft='8px';
    del.onclick = ()=> { storedEvents[k].splice(idx,1); localStorage.setItem('profile_events', JSON.stringify(storedEvents)); selectDay(y,m,d); };
    li.appendChild(del); eventListEl.appendChild(li);
  });
  newEventInput.dataset.key = k;
}
function addEvent(){
  const key = newEventInput.dataset.key;
  if(!key) return alert('Pick a date first');
  if(!storedEvents[key]) storedEvents[key] = [];
  const v = newEventInput.value.trim();
  if(!v) return;
  storedEvents[key].push(v);
  localStorage.setItem('profile_events', JSON.stringify(storedEvents));
  const [yy,mm,dd] = key.split('-').map(Number);
  selectDay(yy,mm,dd);
  newEventInput.value = '';
}
function prevMonth(){ calDate.setMonth(calDate.getMonth()-1); renderCalendar(); }
function nextMonth(){ calDate.setMonth(calDate.getMonth()+1); renderCalendar(); }
renderCalendar();

/* ---------------- News (Google News via AllOrigins) ---------------- */
async function fetchTopHeadlines(){
  try{
    const proxy = 'https://api.allorigins.win/get?url=';
    const url = encodeURIComponent('https://news.google.com/rss?hl=en-US&gl=US&ceid=US:en');
    const res = await fetch(proxy + url);
    const j = await res.json();
    const xml = (new DOMParser()).parseFromString(j.contents, 'text/xml');
    const items = xml.querySelectorAll('item');
    const newsGrid = document.getElementById('newsGrid');
    newsGrid.innerHTML = '';
    for(let i=0;i<6 && i<items.length; i++){
      const it = items[i];
      const title = it.querySelector('title') ? it.querySelector('title').textContent : 'No title';
      const link = it.querySelector('link') ? it.querySelector('link').textContent : '#';
      const descNode = it.querySelector('description');
      const desc = descNode ? descNode.textContent.replace(/<\/?[^>]+(>|$)/g,"") : '';
      const div = document.createElement('div'); div.className='article';
      div.innerHTML = `<h4 style="margin:6px 0"><a href="${link}" target="_blank" rel="noopener">${title}</a></h4><p>${desc.length>200?desc.slice(0,200)+'...':desc}</p>`;
      newsGrid.appendChild(div);
    }
  }catch(e){
    console.error('News error', e);
  }
}
fetchTopHeadlines();
setInterval(fetchTopHeadlines, 30*60*1000);

/* ---------------- Secret redirect ---------------- */
document.getElementById('secretArea').addEventListener('click', ()=>{
  const code = prompt('Enter the secret code:');
  if(code === '494849') window.location.href = 'https://poki.com';
});

/* ---------------- Infinite Crossy Road Game ---------------- */
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');

let dpr = window.devicePixelRatio || 1;
let cssW = 0, cssH = 0;
const TILE = 20;
const SAFE_EVERY = 10;      // safe zone every 10 lanes
const INITIAL_GENERATE = 80; // initial lanes to generate

let lanes = [];    // lanes[0] bottom-most lane index 0
let player = null; // { x, y, size }
let cameraY = 0;
let lastTS = null;
let score = 0;
let high = +localStorage.getItem('crossy_high') || 0;

// fit canvas to CSS size and set transform so we draw in CSS px
function fitCanvas(){
  const rect = canvas.getBoundingClientRect();
  cssW = rect.width;
  cssH = rect.height;
  dpr = window.devicePixelRatio || 1;
  canvas.width = Math.round(cssW * dpr);
  canvas.height = Math.round(cssH * dpr);
  ctx.setTransform(dpr, 0, 0, dpr, 0, 0);
}
window.addEventListener('resize', ()=>{
  fitCanvas();
  // clamp player.x if needed
  if(player) player.x = Math.max(0, Math.min(cssW - player.size, player.x));
});
fitCanvas();

// lane creation: increased river chance, randomized positions to avoid vertical alignment
function makeLane(idx){
  if(idx % SAFE_EVERY === 0) return { type:'safe', items:[] };
  const r = Math.random();
  // more rivers: ~40%
  if(r < 0.40){
    const count = 2 + Math.floor(Math.random()*3); // 2..4 logs
    const baseSpeed = (Math.random()*60 + 30) * (Math.random()<0.5 ? 1 : -1); // px/sec
    const items = [];
    const gap = Math.max(120, Math.floor(cssW / count));
    for(let i=0;i<count;i++){
      const jitter = (Math.random() - 0.5) * gap * 0.6;
      const x = (i * gap) + jitter + (Math.random()*60 - 30);
      items.push({ x: x, w: 80, speed: baseSpeed });
    }
    return { type:'river', items, baseSpeed };
  } else if(r < 0.75){
    // road ~35%
    const count = 2 + Math.floor(Math.random()*3); // 2..4 cars
    const baseSpeed = (Math.random()*80 + 40) * (Math.random()<0.5 ? 1 : -1);
    const items = [];
    const gap = Math.max(120, Math.floor(cssW / count));
    for(let i=0;i<count;i++){
      const jitter = (Math.random() - 0.5) * gap * 0.6;
      const x = (i * gap) + jitter + (Math.random()*80 - 40);
      items.push({ x: x, w: 40, speed: baseSpeed });
    }
    return { type:'road', items, baseSpeed };
  } else {
    return { type:'grass', items:[] };
  }
}

// ensure lanes exist up to index n
function ensureLanes(n){
  while(lanes.length <= n) lanes.push(makeLane(lanes.length));
}

// init world & player
function initWorld(preserveLanes = true){
  if(!preserveLanes) lanes = [];
  ensureLanes(INITIAL_GENERATE);
  // place player at bottom safe area (lane ~26)
  const startLane = 26;
  player = {
    x: Math.floor((cssW/2) / TILE) * TILE,
    y: startLane * TILE,
    size: TILE,
    onLog: false
  };
  cameraY = Math.max(0, player.y - cssH/2);
  lastTS = null;
  score = 0;
}
initWorld(true);

// move player snapped to tiles
function movePlayer(dir){
  if(!player) return;
  if(dir === 'up') player.y -= TILE;
  else if(dir === 'down') player.y += TILE;
  else if(dir === 'left') player.x -= TILE;
  else if(dir === 'right') player.x += TILE;
  // clamp and snap
  player.x = Math.max(0, Math.min(cssW - player.size, player.x));
  player.x = Math.round(player.x / TILE) * TILE;
  player.y = Math.max(0, Math.round(player.y / TILE) * TILE);
  ensureLanes(Math.floor(player.y / TILE) + 80); // pre-generate far ahead
}

// keypad and keyboard
document.querySelectorAll('#keypad .kbtn').forEach(btn=>{
  btn.addEventListener('click', ()=>{
    const d = btn.dataset.dir || btn.getAttribute('data-dir');
    if(d === 'reset'){ initWorld(true); return; }
    movePlayer(d);
  });
});
window.addEventListener('keydown', (e)=>{
  if(e.key === 'ArrowUp') movePlayer('up');
  if(e.key === 'ArrowDown') movePlayer('down');
  if(e.key === 'ArrowLeft') movePlayer('left');
  if(e.key === 'ArrowRight') movePlayer('right');
  if(e.key.toLowerCase() === 'r') initWorld(true);
});

// main loop
function gameLoop(ts){
  if(!lastTS) lastTS = ts;
  const dt = Math.min(50, ts - lastTS); // ms
  lastTS = ts;

  // camera follow
  cameraY = player.y - cssH/2;
  if(cameraY < 0) cameraY = 0;

  const topIndex = Math.floor(cameraY / TILE);
  const visibleRows = Math.ceil(cssH / TILE) + 6;
  ensureLanes(topIndex + visibleRows + 40);

  // update movers
  for(let i = topIndex; i <= topIndex + visibleRows; i++){
    const lane = lanes[i];
    if(!lane) continue;
    for(const item of lane.items){
      item.x += (item.speed * (dt/1000)); // px per frame scaled by time
      // wrap
      if(item.speed > 0 && item.x > cssW + 300) item.x = -300;
      if(item.speed < 0 && item.x < -300) item.x = cssW + 300;
    }
  }

  // interaction: find player's lane
  const pLane = Math.floor(player.y / TILE);
  const lane = lanes[pLane];
  let died = false;
  player.onLog = false;

  if(lane){
    if(lane.type === 'road'){
      for(const car of lane.items){
        const cx = Math.round(car.x);
        const cw = car.w || 40;
        if(player.x < cx + cw && player.x + player.size > cx){
          died = true;
          break;
        }
      }
    } else if(lane.type === 'river'){
      for(const log of lane.items){
        const lx = Math.round(log.x);
        const lw = log.w || 80;
        if(player.x < lx + lw && player.x + player.size > lx){
          player.onLog = true;
          // move with log in fractional pixels
          player.x += (log.speed * (dt/1000));
          break;
        }
      }
      if(!player.onLog) died = true;
    }
  }

  if(died){
    // handle high score and reset player (preserve world)
    if(score > high){ high = score; localStorage.setItem('crossy_high', high); }
    initWorld(true);
    lastTS = null;
    requestAnimationFrame(gameLoop);
    return;
  }

  // keep player x on grid (avoid straddle)
  player.x = Math.max(0, Math.min(cssW - player.size, player.x));
  player.x = Math.round(player.x / TILE) * TILE;

  // draw
  ctx.clearRect(0,0,cssW,cssH);

  // visible lanes draw
  for(let i = topIndex; i <= topIndex + visibleRows; i++){
    const laneObj = lanes[i];
    if(!laneObj) continue;
    const y = Math.round(i * TILE - cameraY);
    if(laneObj.type === 'safe'){ ctx.fillStyle = '#e7ffe8'; ctx.fillRect(0, y, cssW, TILE); }
    else if(laneObj.type === 'grass'){ ctx.fillStyle = '#bff0b0'; ctx.fillRect(0, y, cssW, TILE); }
    else if(laneObj.type === 'road'){ ctx.fillStyle = '#666'; ctx.fillRect(0, y, cssW, TILE);
      for(const car of laneObj.items){ ctx.fillStyle = '#d44'; ctx.fillRect(Math.round(car.x), y+1, car.w || 40, TILE-2); } }
    else if(laneObj.type === 'river'){ ctx.fillStyle = '#09aaff'; ctx.fillRect(0, y, cssW, TILE);
      for(const log of laneObj.items){ ctx.fillStyle = '#8b5a2b'; ctx.fillRect(Math.round(log.x), y+1, log.w || 80, TILE-2); } }
  }

  // draw player
  ctx.fillStyle = '#ffd400';
  const drawX = Math.round(player.x);
  const drawY = Math.round(player.y - cameraY);
  ctx.fillRect(drawX, drawY, player.size, player.size);

  // update score: base line is start lane index 26
  const startBase = 26;
  score = Math.max(0, Math.floor(player.y / TILE) - startBase);
  document.getElementById('scoreboard').innerHTML = `Score: ${score}<br>High: ${high}`;

  requestAnimationFrame(gameLoop);
}

// start everything
fitCanvas();
initWorld(true);
requestAnimationFrame(gameLoop);

</script>
</body>
</html>
